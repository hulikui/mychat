<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>myChat</title>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>

	<script type="text/javascript" src="/assets/bower_components/angular/angular.min.js"></script>
</head>
<body>
<div ng-app="app" ng-controller="ctrl">
  <input type="text" ng-model="msg" placeholder="点击输入文字"></input>
  <button ng-click="toggle()">send</button>
  
  <ul>
	<li ng-repeat="message in messages track by $index">
	{{message}}
	</li>
  </ul>
</div>
<script type="text/javascript">
	//创建angular模型
	var app=angular.module('app',[]);
	//创建控制器
	app.controller('ctrl',function($scope){
	var Msgs=[];
	var socket=io.connect('/');
	socket.emit('getAllMessages');
	socket.on('connected',function(){
		alert('connected to mychat~!')
});
	socket.on('newClient',function(socket){
	console.log('newClient:',socket);
});
	socket.on('allMessages',function(messages){
	console.log('allMessages->messages:',messages);
	Msgs=messages.slice();
	$scope.$apply(function(){
	$scope.messages=Msgs;	
})
});
	socket.on('newMessage',function(message){
	console.log('Get a new message:',message);
	Msgs.unshift(message);
	$scope.$apply(function(){
	$scope.messages=Msgs;
});
});
	$scope.toggle=function(){
	socket.emit('addMessage',$scope.msg);
}
});
</script>
</body>

</html>
